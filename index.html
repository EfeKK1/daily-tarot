<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Daily Tarot</title>

  <!-- Google Font: Mystery Quest -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link 
    href="https://fonts.googleapis.com/css2?family=Mystery+Quest&display=swap" 
    rel="stylesheet"
  >

  <style>
    /* RESET */
    * {
      box-sizing: border-box;
      margin: 0; padding: 0;
    }
    body {
      font-family: "Mystery Quest", cursive;
      background: url("https://images.unsplash.com/photo-1615315685401-1396dcc53f61?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80")
        no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      overflow-x: hidden;
    }
    body::before {
      content: "";
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      pointer-events: none;
      z-index: 0;
    }

    .container {
      max-width: 900px; width: 95%;
      margin: 40px auto;
      background-color: rgba(0,0,0,0.7);
      backdrop-filter: blur(4px);
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.7);
      padding: 30px 20px;
      text-align: center;
      position: relative; z-index: 1;
      animation: fadeIn 1s ease forwards;
    }
    @keyframes fadeIn {
      0% { opacity: 0; transform: scale(0.9); }
      100% { opacity: 1; transform: scale(1); }
    }

    h1 {
      font-size: 2.2em; margin-bottom: 10px;
      text-shadow: 2px 2px 4px #000;
    }
    p.subtitle {
      margin-bottom: 20px;
      font-size: 1.1em;
      color: #ddd;
      text-shadow: 1px 1px 2px #000;
    }

    /* LANG TOGGLE */
    .lang-toggle {
      position: absolute;
      top: 15px; right: 15px;
      background-color: #dab03f;
      color: #300066;
      border: none;
      padding: 10px 18px;
      font-size: 1em;
      font-weight: bold;
      border-radius: 20px;
      cursor: pointer;
      transition: transform 0.3s ease, background-color 0.3s ease;
      font-family: inherit;
      z-index: 2;
    }
    .lang-toggle:hover {
      background-color: #bf9a34;
      transform: scale(1.05);
    }

    /* STREAK & BUTTON */
    #streakContainer {
      font-size: 1.2em;
      margin-bottom: 15px;
      text-shadow: 1px 1px 2px #000;
    }
    button.action-btn {
      background-color: #d8af3f;
      color: #300066;
      border: none;
      padding: 15px 30px;
      font-size: 1.2em;
      font-weight: bold;
      border-radius: 30px;
      margin: 10px 6px;
      cursor: pointer;
      transition: transform 0.3s ease, background-color 0.3s ease;
      font-family: inherit;
    }
    button.action-btn:hover {
      background-color: #bf9a34;
      transform: scale(1.05);
    }

    /* MESSAGES */
    #message {
      margin-top: 8px;
      font-size: 1.05em;
      color: #ffdddd;
      min-height: 24px; 
      text-shadow: 1px 1px 2px #000;
    }

    /* 3-CARD LAYOUT */
    .three-cards {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 25px;
    }
    .card-container {
      flex: 1 1 28%;
      background-color: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      min-width: 180px;
      box-shadow: 0 0 10px rgba(255,255,255,0.2);
      animation: flipIn 0.8s ease forwards;
      transition: box-shadow 0.3s ease, transform 0.3s ease;
      transform-style: preserve-3d;
    }
    .card-container:hover {
      box-shadow: 0 0 15px rgba(255,255,255,0.4);
      transform: scale(1.03);
    }
    @keyframes flipIn {
      0% {
        transform: rotateY(90deg) scale(0.9);
        opacity: 0;
      }
      100% {
        transform: rotateY(0) scale(1);
        opacity: 1;
      }
    }
    .position-label {
      color: #fff;
      margin-bottom: 8px;
      font-size: 1.1em;
      text-transform: uppercase;
      letter-spacing: 1px;
      text-shadow: 1px 1px 2px #000;
    }
    .card-container img {
      max-width: 160px;
      margin-bottom: 10px;
      border-radius: 6px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.6);
      transition: transform 0.5s;
    }
    .card-title {
      font-size: 1.15em;
      color: #ffd700;
      text-shadow: 1px 1px 3px #000;
      margin-bottom: 6px;
    }
    .card-desc {
      font-size: 0.95em;
      text-align: justify;
      line-height: 1.3;
    }

    /* AI READING OUTPUT */
    #aiReadingContainer {
      display: none;
      margin-top: 20px;
      background-color: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(255,255,255,0.3);
      font-size: 1em;
      text-align: justify;
      backdrop-filter: blur(5px);
    }
  </style>
</head>
<body>

  <!-- Dil SeÃ§im Butonu -->
  <button class="lang-toggle" id="langToggleBtn">TR / EN</button>

  <div class="container">
    <h1 id="titleText">Daily Tarot</h1>
    <p class="subtitle" id="subtitleText">
      Draw your three cards once a day. Keep your streak blazing among the stars, and let each card guide you with deeper advice.
    </p>

    <!-- Streak -->
    <div id="streakContainer"></div>

    <!-- Draw & AI Buttons -->
    <div>
      <button class="action-btn" id="drawCardsBtn">Draw 3 Cards</button>
      <button class="action-btn" id="aiReadingBtn" style="display:none;">AI Reading</button>
    </div>
    <!-- Feedback Message -->
    <div id="message"></div>

    <!-- 3 Cards Layout -->
    <div class="three-cards" id="threeCardsContainer"></div>

    <!-- AI Reading Output -->
    <div id="aiReadingContainer"></div>
  </div>

  <script>
    /************************************************************
     *                 BILINGUAL UI TEXT (EN/TR)                *
     ************************************************************/
    const uiTexts = {
      en: {
        title: "Daily Tarot",
        subtitle: "Draw your three cards once a day. Keep your streak blazing among the stars, and let each card guide you with deeper advice.",
        drawButton: "Draw 3 Cards",
        aiButton: "AI Reading",
        alreadyDrewMsg: "You have already drawn today's tarot. Let the day pass and come back tomorrow!",
        synergyFallback: "",
        streakLabel: "Streak",
        positionPast: "Past",
        positionPresent: "Present",
        positionFuture: "Future",
        aiReadingIntro: "Combining these cards with your context, here's an AI-powered reflection:"
      },
      tr: {
        title: "GÃ¼nlÃ¼k Tarot",
        subtitle: "GÃ¼nde bir kez Ã¼Ã§ kart Ã§ekin. YÄ±ldÄ±zlar arasÄ±nda serinizi canlÄ± tutun ve her kartÄ±n derin Ã¶nerileriyle yolunuzu bulun.",
        drawButton: "3 Kart Ã‡ek",
        aiButton: "AI Yorum",
        alreadyDrewMsg: "BugÃ¼nÃ¼n tarotunu zaten Ã§ektiniz. GÃ¼n bitsin, yarÄ±n tekrar gelin!",
        synergyFallback: "",
        streakLabel: "Seri",
        positionPast: "GeÃ§miÅŸ",
        positionPresent: "Åžimdi",
        positionFuture: "Gelecek",
        aiReadingIntro: "Bu kartlarÄ± ve durumunuzu harmanlayarak, yapay zekÃ¢dan gelen yorum:"
      }
    };

    let currentLang = "en";
    /**************** LANG TOGGLE ****************/
    const langToggleBtn = document.getElementById("langToggleBtn");
    const titleText = document.getElementById("titleText");
    const subtitleText = document.getElementById("subtitleText");
    const drawCardsBtn = document.getElementById("drawCardsBtn");
    const aiReadingBtn = document.getElementById("aiReadingBtn");
    const messageDiv = document.getElementById("message");
    const streakContainer = document.getElementById("streakContainer");
    const threeCardsContainer = document.getElementById("threeCardsContainer");
    const aiReadingContainer = document.getElementById("aiReadingContainer");

    function applyLanguage() {
      const t = uiTexts[currentLang];
      titleText.textContent = t.title;
      subtitleText.textContent = t.subtitle;
      drawCardsBtn.textContent = t.drawButton;
      aiReadingBtn.textContent = t.aiButton;
      if (lastDrawDate === formatDate()) {
        messageDiv.textContent = t.alreadyDrewMsg;
      }
      updateStreakDisplay();
    }
    function toggleLanguage(){
      currentLang = (currentLang==="en") ? "tr" : "en";
      applyLanguage();
    }
    langToggleBtn.addEventListener("click", toggleLanguage);

    /**************** STREAK & DAILY ****************/
    let lastDrawDate = localStorage.getItem("dailyTarotLastDraw") || null;
    let streakCount = parseInt(localStorage.getItem("dailyTarotStreak") || "0");

    function formatDate(d=new Date()) {
      const day = String(d.getDate()).padStart(2,"0");
      const mon = String(d.getMonth()+1).padStart(2,"0");
      const yr = d.getFullYear();
      return `${day}.${mon}.${yr}`;
    }
    function updateStreakDisplay(){
      const t = uiTexts[currentLang];
      streakContainer.textContent = `${t.streakLabel}: ${streakCount} ðŸ”¥`;
    }
    (function checkStreakOnLoad(){
      if(!lastDrawDate){
        streakCount = 0;
        localStorage.setItem("dailyTarotStreak", "0");
      } else {
        const todayStr = formatDate();
        if(lastDrawDate !== todayStr){
          const [dd,mm,yy] = lastDrawDate.split(".").map(Number);
          const lastDateObj = new Date(yy, mm-1, dd);
          const now = new Date();
          const diffTime = now - lastDateObj;
          const diffDays = Math.floor(diffTime / (1000*60*60*24));
          if(diffDays>1){
            streakCount=0;
            localStorage.setItem("dailyTarotStreak","0");
          }
        }
      }
      applyLanguage(); // init UI
    })();

    /**************** TAROT DECK (78, 24 local, others link) ****************/
    // Her kart -> name, image, upright: {en, tr}, reversed: {en, tr}
    // Basit Ã¶rnek 8-10 kart. Siz 78'i doldurabilirsiniz.
    const tarotDeck = [
      {
        name: "Two of Wands",
        image: "images/twoofwands.jpg",
        upright: {
          en: "You stand at a threshold, planning your future steps. Take bold action after careful thought; the world awaits your initiative.",
          tr: "Bir eÅŸikte duruyorsunuz, gelecek adÄ±mlarÄ±nÄ±zÄ± planlÄ±yorsunuz. Dikkatli dÃ¼ÅŸÃ¼nÃ¼p cesur hareket edin; dÃ¼nya atÄ±lÄ±mÄ±nÄ±zÄ± bekliyor."
        },
        reversed: {
          en: "Indecision and overthinking might stall your progress. Balance your fears with realistic goals, and move forward with caution.",
          tr: "Karar verememe ve fazla dÃ¼ÅŸÃ¼nme ilerlemenizi durdurabilir. KorkularÄ±nÄ±zÄ± gerÃ§ekÃ§i hedeflerle dengeleyip, dikkatle ilerleyin."
        }
      },
      {
        name: "Ace of Cups",
        image: "images/aceofcups.jpg",
        upright: {
          en: "A wellspring of emotion or creativity is opening for you. Embrace heartfelt connections and let compassion flow.",
          tr: "Duygusal veya yaratÄ±cÄ± bir kaynak sizin iÃ§in aÃ§Ä±lÄ±yor. Ä°Ã§ten baÄŸlarÄ± kucaklayÄ±n ve ÅŸefkati akÄ±ÅŸÄ±na bÄ±rakÄ±n."
        },
        reversed: {
          en: "Unspoken feelings or emotional blockage hinder deeper intimacy. Healing old wounds may unlock genuine affection.",
          tr: "Dile getirilmemiÅŸ duygular veya duygusal tÄ±kanÄ±klÄ±k, derin yakÄ±nlaÅŸmayÄ± engelliyor. Eski yaralarÄ± iyileÅŸtirmek gerÃ§ek sevgiye kapÄ± aÃ§abilir."
        }
      },
      {
        name: "The Chariot",
        image: "images/thechariot.jpg",
        upright: {
          en: "Your determination and self-control fuel your journey to success. Harness opposing forces and direct them with confidence.",
          tr: "KararlÄ±lÄ±ÄŸÄ±nÄ±z ve Ã¶zdenetiminiz baÅŸarÄ± yolculuÄŸunuzu besliyor. ZÄ±t gÃ¼Ã§leri kontrol edin ve gÃ¼venle yÃ¶nlendirin."
        },
        reversed: {
          en: "Scattered energy or internal conflict halts your progress. Regain your focus and align your will before proceeding.",
          tr: "DaÄŸÄ±nÄ±k enerji veya iÃ§sel Ã§atÄ±ÅŸma ilerlemenizi durduruyor. Devam etmeden Ã¶nce odaÄŸÄ±nÄ±zÄ± ve iradenizi yeniden toplayÄ±n."
        }
      },
      // ... Devamla 78 kart. Bir kÄ±smÄ±nÄ± local images, bir kÄ±smÄ±nÄ± link
      {
        name: "Ace of Swords",
        image: "https://upload.wikimedia.org/wikipedia/commons/1/1b/Swords01.jpg",
        upright: {
          en: "A sharp new idea or truth can cut through confusion. Use clarity for righteous purposes.",
          tr: "Keskin yeni bir fikir veya gerÃ§ek, karmaÅŸayÄ± kesebilir. Bu netliÄŸi adil amaÃ§lar iÃ§in kullanÄ±n."
        },
        reversed: {
          en: "Clouded thoughts or misuse of logic sow conflict. Step back and reconsider your approach.",
          tr: "BulanÄ±k dÃ¼ÅŸÃ¼nceler veya mantÄ±ÄŸÄ±n yanlÄ±ÅŸ kullanÄ±mÄ± Ã§atÄ±ÅŸma doÄŸurur. Geri Ã§ekilip yaklaÅŸÄ±mÄ±nÄ±zÄ± tekrar gÃ¶zden geÃ§irin."
        }
      }
      // ...
    ];

    /**************** DRAW LOGIC ****************/
    const drawCardsBtnEl = document.getElementById("drawCardsBtn");
    let drewToday = false; 
    let chosenCardsState = [];

    drawCardsBtnEl.addEventListener("click", () => {
      const t = uiTexts[currentLang];
      const todayStr = formatDate();
      if (lastDrawDate === todayStr) {
        // same day
        messageDiv.textContent = t.alreadyDrewMsg;
        return;
      }
      messageDiv.textContent = "";
      threeCardsContainer.innerHTML = "";
      aiReadingContainer.style.display = "none";
      aiReadingContainer.textContent = "";
      aiReadingBtn.style.display = "none"; // Reset

      // pick 3 distinct
      const idxSet = new Set();
      while(idxSet.size<3) {
        idxSet.add(Math.floor(Math.random()*tarotDeck.length));
      }
      const chosenIdx = [...idxSet].sort((a,b)=>a-b);

      const posLabels = [t.positionPast, t.positionPresent, t.positionFuture];
      const resultCards = [];

      chosenIdx.forEach((deckI, i)=>{
        const card = tarotDeck[deckI];
        const isRev = Math.random()<0.5;
        
        const cardDiv = document.createElement("div");
        cardDiv.className = "card-container";

        const label = document.createElement("h4");
        label.className="position-label";
        label.textContent = posLabels[i];
        cardDiv.appendChild(label);

        const img = document.createElement("img");
        img.src = card.image;
        if(isRev) img.style.transform="rotate(180deg)";
        cardDiv.appendChild(img);

        const title = document.createElement("h5");
        title.className="card-title";
        title.textContent = card.name + (isRev?" (Reversed)":"");
        cardDiv.appendChild(title);

        const desc = document.createElement("p");
        desc.className="card-desc";
        desc.textContent = isRev
          ? card.reversed[currentLang]
          : card.upright[currentLang];
        cardDiv.appendChild(desc);

        threeCardsContainer.appendChild(cardDiv);

        resultCards.push({name: card.name, isReversed: isRev});
      });

      // daily usage
      lastDrawDate = todayStr;
      localStorage.setItem("dailyTarotLastDraw", lastDrawDate);

      if (streakCount<=0) {
        streakCount=1;
      } else {
        streakCount++;
      }
      localStorage.setItem("dailyTarotStreak", streakCount.toString());
      updateStreakDisplay();

      drewToday = true;
      chosenCardsState = resultCards;

      // AI Reading butonunu gÃ¶ster
      aiReadingBtn.style.display="inline-block";
    });

    /**************** AI READING LOGIC ****************/
    const aiReadingBtnEl = document.getElementById("aiReadingBtn");

    aiReadingBtnEl.addEventListener("click", async ()=>{
      if (!drewToday) return; // henÃ¼z kart Ã§ekilmediyse AI yorumu yok

      const t = uiTexts[currentLang];
      aiReadingContainer.style.display = "block";
      aiReadingContainer.textContent = "...";

      try {
        // 1) Prompt oluÅŸtur
        const prompt = buildPrompt(chosenCardsState, currentLang);

        // 2) OpenAI API'ye istek (Bu Ã¶rnekte direk front-end, GÃœVENLÄ° DEÄžÄ°L)
        // GerÃ§ek projede BACKEND'e istek atÄ±n.
        const apiKey = "YOUR_OPENAI_API_KEY"; // Buraya API key yazmayÄ±n, demo only.

        const response = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type":"application/json",
            "Authorization": `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: "gpt-3.5-turbo", 
            messages: [
              {
                role: "system",
                content: (currentLang==="en")
                  ? "You are an expert tarot reader, offering deep spiritual guidance and practical advice..."
                  : "Sen uzman bir tarot okuyucususun. KullanÄ±cÄ±ya derin ruhsal rehberlik ve pratik Ã¶neriler veriyorsun..."
              },
              {
                role: "user",
                content: prompt
              }
            ],
            max_tokens: 700,
            temperature: 0.9
          })
        });
        const data = await response.json();
        const aiText = data.choices?.[0]?.message?.content || "";
        
        // 3) Sonucu ekrana yaz
        aiReadingContainer.textContent = t.aiReadingIntro + "\n\n" + aiText;
      } catch(err){
        aiReadingContainer.textContent = "AI request failed: " + err.message;
      }
    });

    // Bir Ã¶rnek prompt oluÅŸturma
    function buildPrompt(cards, lang){
      const cardList = cards.map(c => {
        let revTag = c.isReversed ? (lang==="en"?"(Reversed)":"(Ters)") : "";
        return `- ${c.name} ${revTag}`;
      }).join("\n");
      if (lang==="en"){
        return `Below are 3 tarot cards the user has drawn:\n\n${cardList}\n
Please provide a combined interpretation of these cards, offering reflective and practical advice for the user. Write in a supportive, empathetic style.`;
      } else {
        return `KullanÄ±cÄ±nÄ±n Ã§ektiÄŸi 3 tarot kartÄ± aÅŸaÄŸÄ±dadÄ±r:\n\n${cardList}\n
Bu kartlar hakkÄ±nda kapsamlÄ± bir yorum yap, kullanÄ±cÄ±nÄ±n yaÅŸamÄ±na uygulayabileceÄŸi Ã¶neriler ekle. Destekleyici ve empatik bir Ã¼slup kullan.`;
      }
    }
  </script>
</body>
</html>
